{"version":3,"file":"commonHelpers.js","sources":["../src/js/pixabay-api.js","../src/js/render-functions.js","../src/main.js"],"sourcesContent":["import axios from 'axios';\n\nconst API_KEY = '42476870-3a5632db826cc102513b658b4';\nconst BASE_URL = 'https://pixabay.com';\nconst END_POINT = '/api/';\n\nexport async function searchImages(search, page) {\n  const PARAMS = `?key=${API_KEY}&q=${search}&image_type=photo&orientation=horizontal&safesearch=true&per_page=15&page=${page}`;\n  const url = `${BASE_URL}${END_POINT}${PARAMS}`;\n\n  try {\n    //рефакторинг кода на axios\n    const response = await axios.get(url);\n\n    if (response.status !== 200) {\n      throw new Error(response.status);\n    }\n\n    if (response.data.hits && response.data.hits.length > 0) {\n      return response.data;\n    } else {\n      throw new Error('No images found');\n    }\n  } catch (error) {\n    throw new Error(\n      `Failed to fetch images from Pixabay API: ${error.message}`\n    );\n  }\n}\n","import iziToast from 'izitoast';\nimport SimpleLightbox from 'simplelightbox';\n\nconst lightbox = new SimpleLightbox('.img-container a', {\n  overlay: true,\n  overlayOpacity: 0.9,\n  animationSpeed: 1000,\n  scrollZoomFactor: 0.1,\n  navText: ['←', '→'],\n  captionsData: 'alt',\n  captionDelay: 250,\n});\n\nexport function renderMarkup(refs, pics) {\n  // refs.infoEl.innerHTML = '';\n\n  if (!pics || pics.length === 0) {\n    iziToast.error({\n      message:\n        'Sorry, there are no images matching your search query. Please try again!',\n      position: 'center',\n      transitionIn: 'fadeInLeft',\n    });\n  } else {\n    const markup = createMarkup(pics);\n    refs.infoEl.insertAdjacentHTML('beforeend', markup);\n    lightbox.refresh();\n  }\n}\n\nfunction createMarkup(pics) {\n  return pics\n    .map(\n      pic => `<div class=\"image-box\">\n          <div class=\"general-frame\">\n\n            <div class=\"image-container\">\n              <a href=\"${pic.largeImageURL}\" data-lightbox=\"gallery\">\n              <img src=\"${pic.webformatURL}\" alt=\"${pic.tags}\" class=\"my-image\">\n              </a>\n            </div>\n             \n            <div class=\"image-body\">\n                <ul class=\"ul-item\">\n                 <li class=\"image-li\">Likes <span style=\"font-weight: normal;\">${pic.likes}</span></li>\n                 <li class=\"image-li\">Views <span style=\"font-weight: normal;\">${pic.views}</span></li>\n                 <li class=\"image-li\">Comments <span style=\"font-weight: normal;\">${pic.comments}</span></li>\n                 <li class=\"image-li\">Downloads <span style=\"font-weight: normal;\">${pic.downloads}</span></li>\n                </ul>\n              </div>\n          </div>\n    </div>`\n    )\n    .join('');\n}\n","import iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\n\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\n\nimport { searchImages } from './js/pixabay-api.js';\nimport { renderMarkup } from './js/render-functions.js';\n\nconst refs = {\n  formEl: document.querySelector('.search-form'),\n  infoEl: document.querySelector('.img-container'),\n  loader: document.querySelector('.loader'),\n  btnLoadMore: document.querySelector('.js-btn-load'),\n};\n\nlet query;\nlet page; // чтоб запросы не повторялись\nlet maxPage;\n\nrefs.formEl.addEventListener('submit', onFormSubmit);\nrefs.btnLoadMore.addEventListener('click', onLoadMoreClick);\n// ============================================ Функция для снятия/установки индикатора загрузки\nfunction showLoader() {\n  refs.loader.classList.remove('is-hidden');\n}\nfunction hideLoader() {\n  refs.loader.classList.add('is-hidden');\n}\n// ============================================ Функция для кнопки \"load more\" монтаж\\демонтаж из области видимости\nfunction showLoadBtn() {\n  refs.btnLoadMore.classList.remove('is-hidden');\n}\nfunction hideLoadBtn() {\n  refs.btnLoadMore.classList.add('is-hidden');\n}\n// =========================================== Функция для скрытия кнопки load more + очиска разметки, \"прикручиваем\" к ошибкам\nfunction hideLoadBtnAndMarkup() {\n  refs.btnLoadMore.classList.add('is-hidden');\n  refs.infoEl.innerHTML = '';\n}\n// ===================================================================================================================================================================================\nasync function onFormSubmit(e) {\n  e.preventDefault();\n  query = e.target.elements.query.value.trim();\n  page = 1;\n  showLoader();\n  if (query === '') {\n    iziToast.error({\n      message: 'Please enter a search query',\n      position: 'center',\n      transitionIn: 'fadeInLeft',\n    });\n    hideLoader();\n    hideLoadBtn();\n    // hideLoadBtnAndMarkup();\n    return;\n  }\n  e.currentTarget.elements.query.value = ''; //очищаем поле ввода после отправки запроса\n  try {\n    const data = await searchImages(query, page);\n    refs.infoEl.innerHTML = '';\n    if (data.hits && data.hits.length > 0) {\n      renderMarkup(refs, data.hits);\n      hideLoader();\n      maxPage = Math.ceil(data.totalHits / 15);\n      // checkBtnVisibleStatus();\n    } else {\n      iziToast.error({\n        message: 'No images found for the given query',\n        position: 'center',\n        transitionIn: 'fadeInLeft',\n      });\n    }\n  } catch (error) {\n    console.error(error);\n    hideLoader();\n    hideLoadBtnAndMarkup();\n    iziToast.error({\n      message: 'Failed to fetch images. Please try again later.',\n      position: 'center',\n      transitionIn: 'fadeInLeft',\n    });\n  } finally {\n    e.target.reset();\n    checkBtnVisibleStatus();\n  }\n}\n// ================================== Функция для кнопки load more\nasync function onLoadMoreClick() {\n  page += 1;\n  showLoader();\n  try {\n    const data = await searchImages(query, page);\n    renderMarkup(refs, data.hits); // добавляем новые изображения к уже загруженным\n    hideLoader();\n    checkBtnVisibleStatus();\n  } catch (error) {\n    console.error(error);\n    // hideLoader();\n    hideLoadBtnAndMarkup();\n    iziToast.error({\n      message: 'Failed to fetch more images. Please try again later.',\n      position: 'center',\n      transitionIn: 'fadeInLeft',\n    });\n  } finally {\n    //проверяем и сообщаем, если \"конец колекции\"\n    if (page >= maxPage) {\n      iziToast.info({\n        message: 'End of image collection',\n        position: 'center',\n        transitionIn: 'fadeInLeft',\n      });\n    }\n    // получим высоту одной карточки\n    const cardHeight =\n      refs.infoEl.firstElementChild.getBoundingClientRect().height;\n\n    window.scrollBy({\n      top: 6 * cardHeight, // прокрутка на 6 высот карточки\n      behavior: 'smooth', // плавная анимация прокрутки\n    });\n  }\n}\n\n// ================================== Функция для проверки видимости кнопки load more при достижении конца коллекции\nfunction checkBtnVisibleStatus() {\n  if (page >= maxPage) {\n    hideLoadBtn();\n  } else {\n    showLoadBtn();\n  }\n}\n"],"names":["API_KEY","BASE_URL","END_POINT","searchImages","search","page","PARAMS","url","response","axios","error","lightbox","SimpleLightbox","renderMarkup","refs","pics","iziToast","markup","createMarkup","pic","query","maxPage","onFormSubmit","onLoadMoreClick","showLoader","hideLoader","showLoadBtn","hideLoadBtn","hideLoadBtnAndMarkup","e","data","checkBtnVisibleStatus","cardHeight"],"mappings":"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"}